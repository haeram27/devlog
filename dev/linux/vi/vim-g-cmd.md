# vim - gcommand

* g command는 문서내에서 특정 패턴을 포함하는 문서 내 `라인`을 찾아 지정된 명령을 수행한다.
* g command는 `패턴`을 이용한 라인 선택기로 이해하면 편리하다.

---

## 기본 문법

```bash
:g/pattern/command
```

* `pattern`: 정규 표현식으로 검색할 패턴
* `command`: 패턴에 일치하는 줄에 대해 실행할 Ex 명령

---

## 주의 사항

* `:g` 명령은 강력하므로 실수로 많은 줄을 삭제하거나 변경할 수 있습니다.
* 변경 전에는 `:w`로 저장하거나 `u` (undo)로 복구할 준비를 하세요.

---

## 자주 쓰이는 `:g` 명령 모음

### 특정 문자열이 있는 줄만 출력 (비파괴)

syntax: :g/pattern/cmd

```vim
:g/error/
:g/error/p
```

* "error"가 포함된 줄만 출력 (print)
* 별도의 명령이 명시되지 않으면 default로 `p` (print) 명령 실행

### 마지막 패턴 그대로 사용

```vim
:g//cmd
```

---

### 비포함 조건 (반전) 출력

```vim
:g!/success/p
:v/success/p
```

* `v` 는 `g!`와 동일하게 매칭의 반전 의미
* "success"가 없는 줄을 출력

---

### 특정 줄에만 치환 적용

* `DEBUG`가 있는 줄에서만 `foo`를 `bar`로 치환

```vim
:g/DEBUG/s/foo/bar/   # s command는 기본적으로 라인내 매칭 되는 첫번째 단어만 교체함
:g/DEBUG/s/foo/bar/g  # s command에 g 옵션 사용시 라인내 매칭 되는 전체 단어를 교체하도록 함
```

* g command는 라인 선택자로써 동작하며, s command가 라인 내에서 교체 작업을 수행
* g command는 문서내 라인에 대해서 global matching을 수행, s command의 g 옵션은 라인내에서 단어에 대해서 global matching을 지정함

---

### 특정 단어가 있는 줄 삭제

```vim
:g/error/d
```

* `error`가 포함된 모든 줄 삭제

---

### 빈 줄(공백만 있는 줄 포함) 삭제

```vim
:g/^\s*$/d
```

* 완전히 비어 있거나 공백만 있는 줄 삭제

---

### 숫자가 포함된 줄 삭제

```vim
:g/\d/d
```

* 숫자(`0~9`)가 포함된 줄 삭제 (`\d`는 일부 vim에서만 작동. 일반 vi에서는 `[0-9]` 사용)

---

### 주석 줄 삭제 (예: `#`로 시작)

```vim
:g/^\s*#/d
```

→ 공백 후 `#`로 시작하는 줄 삭제

---

### 특정 키워드가 있는 줄만 대문자로 변환

```vim
:g/TODO/norm gUU
```

* `TODO`가 있는 줄을 대문자로 변환 (`norm` = normal 모드 명령 실행)

---

### 특정 문자열이 있는 줄 맨 앞에 텍스트 삽입

```vim
:g/error/s/^/[ERROR] /
```

→ `error`가 있는 줄 앞에 `[ERROR]` 삽입

---

### 패턴이 있는 줄에서 여러 명령 실행

```vim
:g/debug/normal dd
```

* `debug`가 있는 줄을 Normal 모드 명령으로 삭제 (`dd`)

---

## gcommand와 `%` 차이

`%`는 파일의 전체 라인을 의미하는 line range expression 이다.

:s command는 기본적으로 1 라인 단위로 동작하는 명령어이다.
그러므로 :s command를 `파일 전체 라인`에 적용하려면 `%s` 로 명시해야한다.

:g command는 기본적으로 파일 전체 라인을 대상으로 하는 명령어이므로 별도로 `%` 를 적용할 필요가 없다.
반대로 g command를 일부 라인 범위로 국한하여 적용하고 싶다면 line range expression을 적용하여야 한다.

예:

```bash
:10,20g/foo/d
```

### :g — command

* 형식: :g/pattern/command
* 의미: "pattern"이 포함된 줄에 대해서만 "command"를 실행
* 용도: 조건부 라인에 명령 실행시 사용

```vim
:g/error/d
```

* "error"를 포함한 줄 삭제

### `%` — line range expression

* 형식: :%command
* 의미: **전체 줄(1,$)** 범위 축약표현
* 용도: 파일 전체에 대한 일괄 명령 실행시 사용

```vim
:%s/foo/bar/g
```

* 파일 전체에서 "foo"를 "bar"로 모두 치환

### 차이점 정리

| 항목         | `:g`                | `:%`              |
| ---------- | ------------------- | ----------------- |
| 의미         | 특정 패턴이 **있는 줄만** 처리 | **전체 줄 범위** 지정    |
| 조건 기반 처리   | ✅ 가능 (`:g/error/d`) | ❌ 조건 불가, 범위 지정 전용 |
| 줄 선택 여부    | 패턴 매칭 줄만            | 전체 줄              |
| 자주 사용하는 용도 | 조건부 삭제, 치환 등        | 전체 치환, 전체 명령 적용   |

```vim
:1,10s/foo/bar/g   → 1~10줄만 치환
:%s/foo/bar/g      → 전체 줄 치환 (:%는 1,$의 줄 범위 축약)
```
