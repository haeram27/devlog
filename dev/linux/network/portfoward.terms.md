# 포트 포워딩 용어

- 포트 바인딩 (Port Binding)
  - 애플리케이션이 네트워크 사용을 위해 자신이 사용할 포트를 호스트의 특정 IP 주소에 "결합(binding)" 하는 것
  - 바인드는 결국 호스트 주소와 포트를 결합 하는 것을 의미하며, 이는 어플리케이션이 socket에 생성하는 과정으로 대변된다.
  - 어플리케이션은 바인드 과정을 통해서 시스템의 특정 IP 주소에 포트 사용을 예약 및 점유하며 socket을 생성하고 생성된 socket을 이용해 네트워크 송수신을 진행할 수 있음
  - 어플리케이션 입장에서 socket을 생성하는데 사용한 address와 port를 각각 bind address, port를 bind port라고 함
- 포트 포워딩 (Port Forwarding)
  - 네트워크 레벨에서 특정 포트로 들어오는 트래픽을 다른 포트(로컬 또는 다른 호스트)로 재전송(redirect)하는 것
- 바인드 포트 (Bind port)
  - 어플리케이션이 socket을 생성하기 위해 bind 한 포트
- 바인드 address (Bind address)
  - 어플리케이션이 socket을 생성하기 위해 bind 한 address
- 포워드 포트 (Forward port)
  - 포트 포워딩에서 수신된 트래픽을 실제 목적지 포트로 중계(relay)하는 전방 포트

## 포트 바인딩 (Port Binding)

**정의**:

- 애플리케이션이나 서비스가 네트워크 사용을 위해 시스템의 특정 포트를 예약 및 점유 하는것
- 즉 어플리케이션이 socket을 생성할 때 socket에 사용할 시스템의 특정 포트를 예약 및 점유 하는 것을 의미
- 일반적으로 socket 프로그래밍에서 수신용 server-socket에는 bind()를 수행하지만, 송신용 socket에는 bind() 하지 않으나(connect()시 시스템이 자동 할당) 송신용 socket에도 bind() 사용 가능

```python
# Python 예시
import socket

serverSocket = socket.socket()
serverSocket.bind(('0.0.0.0', 8080))  # 모든 NIC(IP)의 8080 포트에 바인딩
serverSocket.listen(5)
```

**특징**:

- 애플리케이션 레벨에서 발생
- 프로세스가 특정 포트를 "점유"
- 해당 포트로 직접 트래픽 송/수신
- `ss -tlnp`로 확인하면 LISTEN 상태로 표시됨

**사용 목적**:

- 어플리케이션이 네트워크 사용을 위해서 자신의 socket에 시스템의 특정 포트를 예약/점유 애햐랄 

**바인딩 주소 예시**:

```bash
# 로컬호스트만 (127.0.0.1:3000)
app.listen(3000, 'localhost')

# 모든 인터페이스 (0.0.0.0:3000)
app.listen(3000, '0.0.0.0')

# 특정 IP만 (192.168.1.10:3000)
app.listen(3000, '192.168.1.10')
```

## 포트 포워딩 (Port Forwarding)

**정의**: 네트워크 레벨에서 특정 포트로 들어오는 트래픽을 다른 포트(로컬 또는 다른 호스트)로 중계(relay)하는 것

```text
클라이언트 → [포트 A (forward-port)] → 포워딩 규칙 → [포트 B (bind-port)] → 애플리케이션
```

**특징**:

- 네트워크/방화벽 레벨에서 발생
- 트래픽의 목적지를 변경
- 애플리케이션은 원래 포트(B)에만 바인딩
- 중간에서 트래픽을 투명하게 전달

**목적**:

- 권한이 필요한 포트(1024 이하)를 사용하면서 일반 권한으로 앱 실행
- 여러 서비스를 하나의 공개 포트로 라우팅
- 보안을 위해 실제 서비스 포트를 숨기고 싶을 때
- 로드 밸런싱이나 리버스 프록시 구성

**종류**:

- **로컬 포트 포워딩** (같은 호스트 내)

```bash
# 8080으로 들어온 트래픽을 3000으로 전달
sudo firewall-cmd --add-forward-port=port=8080:proto=tcp:toport=3000
```

- **원격 포트 포워딩** (다른 호스트로)

```bash
# 8080으로 들어온 트래픽을 다른 서버의 3000으로 전달
sudo firewall-cmd --add-forward-port=port=8080:proto=tcp:toport=3000:toaddr=192.168.1.100
```

## 주요 차이점

| 구분 | 포트 바인딩 | 포트 포워딩 |
|------|------------|------------|
| **레벨** | 애플리케이션 레벨 | 네트워크 레벨 |
| **주체** | 프로그램/프로세스 | 방화벽/라우터/커널 |
| **목적** | 포트에서 직접 수신 | 트래픽 재전송 |
| **설정 위치** | 애플리케이션 코드 | 방화벽/iptables 규칙 |
| **가시성** | `ss -tlnp`로 확인 가능 | 방화벽 규칙으로 확인 |

## 실제 사용 시나리오

### 시나리오 1: 포트 바인딩만 사용

```bash
# 애플리케이션이 80 포트에 직접 바인딩
node app.js --port 80
```

- 80번 포트로 직접 접속
- 루트 권한 필요 (1024 이하 포트)

### 시나리오 2: 바인딩 + 포워딩 조합

```bash
# 애플리케이션은 3000 포트에 바인딩 (일반 권한)
node app.js --port 3000

# 방화벽에서 80 → 3000 포워딩 (루트 권한)
sudo firewall-cmd --add-forward-port=port=80:proto=tcp:toport=3000

```

- 외부에서는 80번으로 접속
- 애플리케이션은 3000번에서 실행
- 일반 권한으로 애플리케이션 실행 가능

### 시나리오 3: Docker의 경우

```bash
docker run -p 8080:3000 myapp
```

- 컨테이너 내 애플리케이션: 3000번에 **바인딩**
- Docker 호스트: 8080 → 3000 **포워딩**

## 확인 방법

```bash
# 바인딩된 포트 확인
sudo ss -tlnp
# LISTEN 상태로 표시됨

# 포워딩 규칙 확인
sudo firewall-cmd --list-forward-ports
# 또는
sudo iptables -t nat -L -n -v
```
